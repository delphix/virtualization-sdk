



<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../images/logo.png">
      <meta name="generator" content="mkdocs-0.17.5, mkdocs-material-2.9.2">
    
    
      
        <title>Data Ingestion - Delphix Virtualization SDK 2.0.0</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.fbb7f3af.css">
      
      
    
    
      <script src="../../assets/javascripts/modernizr.1aa3b519.js"></script>
    
    
      <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
      
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Helvetica+Neue:300,400,400i,700|Ubuntu+Mono">
        <style>body,input{font-family:"Helvetica Neue","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Ubuntu Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#data-ingestion" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../.." title="Delphix Virtualization SDK 2.0.0" class="md-header-nav__button md-logo">
          
            <img src="../../images/delphix-logo-white.png" width="153" height="15">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                Delphix Virtualization SDK 2.0.0
              </span>
              <span class="md-header-nav__topic">
                Data Ingestion
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <span class="md-nav__button md-logo">
      
        <img src="../../images/delphix-logo-white.png" width="48" height="48">
      
    </span>
    Delphix Virtualization SDK 2.0.0
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Welcome!" class="md-nav__link">
      Welcome!
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../Getting_Started/" title="Getting Started" class="md-nav__link">
      Getting Started
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3" checked>
    
    <label class="md-nav__link" for="nav-3">
      Building Your First Plugin
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Building Your First Plugin
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../Overview/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Initial_Setup/" title="Initial Setup" class="md-nav__link">
      Initial Setup
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Discovery/" title="Discovery" class="md-nav__link">
      Discovery
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Data Ingestion
      </label>
    
    <a href="./" title="Data Ingestion" class="md-nav__link md-nav__link--active">
      Data Ingestion
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#how-does-delphix-ingest-data" title="How Does Delphix Ingest Data?" class="md-nav__link">
    How Does Delphix Ingest Data?
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#linking" title="Linking" class="md-nav__link">
    Linking
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#syncing" title="Syncing" class="md-nav__link">
    Syncing
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#our-syncing-strategy" title="Our Syncing Strategy" class="md-nav__link">
    Our Syncing Strategy
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#defining-your-linked-source-data-format" title="Defining Your Linked Source Data Format" class="md-nav__link">
    Defining Your Linked Source Data Format
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#implementing-syncing-in-your-plugin" title="Implementing Syncing in Your Plugin" class="md-nav__link">
    Implementing Syncing in Your Plugin
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mount-specification" title="Mount Specification" class="md-nav__link">
    Mount Specification
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#data-copying" title="Data Copying" class="md-nav__link">
    Data Copying
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#saving-snapshot-data" title="Saving Snapshot Data" class="md-nav__link">
    Saving Snapshot Data
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-to-link-and-sync-in-the-delphix-engine" title="How to Link and Sync in the Delphix Engine" class="md-nav__link">
    How to Link and Sync in the Delphix Engine
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Provisioning/" title="Provisioning" class="md-nav__link">
      Provisioning
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Versioning And Upgrade
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Versioning And Upgrade
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../Versioning_And_Upgrade/Overview/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Versioning_And_Upgrade/Versioning/" title="Versioning" class="md-nav__link">
      Versioning
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Versioning_And_Upgrade/Upgrade/" title="Upgrade" class="md-nav__link">
      Upgrade
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Versioning_And_Upgrade/Compatibility/" title="Compatibility" class="md-nav__link">
      Compatibility
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Versioning_And_Upgrade/Backports_And_Hotfixes/" title="Backports and Hotfixes" class="md-nav__link">
      Backports and Hotfixes
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Versioning_And_Upgrade/Replication/" title="Replication" class="md-nav__link">
      Replication
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      References
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        References
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../References/CLI/" title="CLI" class="md-nav__link">
      CLI
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../References/Plugin_Config/" title="Plugin Config" class="md-nav__link">
      Plugin Config
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../References/Decorators/" title="Decorators" class="md-nav__link">
      Decorators
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../References/Plugin_Operations/" title="Plugin Operations" class="md-nav__link">
      Plugin Operations
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../References/Schemas/" title="Schemas" class="md-nav__link">
      Schemas
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../References/Schemas_and_Autogenerated_Classes/" title="Schemas and Autogenerated Classes" class="md-nav__link">
      Schemas and Autogenerated Classes
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../References/Platform_Libraries/" title="Platform Libraries" class="md-nav__link">
      Platform Libraries
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../References/Logging/" title="Logging" class="md-nav__link">
      Logging
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../References/Workflows/" title="Workflows" class="md-nav__link">
      Workflows
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../References/Classes/" title="Classes" class="md-nav__link">
      Classes
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../References/Glossary/" title="Glossary" class="md-nav__link">
      Glossary
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      Best Practices
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        Best Practices
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../Best_Practices/CLI_Configuration_File/" title="CLI Configuration File" class="md-nav__link">
      CLI Configuration File
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Best_Practices/Code_Sharing/" title="Code Sharing" class="md-nav__link">
      Code Sharing
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Best_Practices/Managing_Scripts_For_Remote_Execution/" title="Managing Scripts for Remote Execution" class="md-nav__link">
      Managing Scripts for Remote Execution
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Best_Practices/User_Visible_Errors/" title="User Visible Errors" class="md-nav__link">
      User Visible Errors
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Best_Practices/Sensitive_Data/" title="Dealing With Sensitive Data" class="md-nav__link">
      Dealing With Sensitive Data
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Best_Practices/Unicode_Data/" title="Working with Unicode Data" class="md-nav__link">
      Working with Unicode Data
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Best_Practices/Working_with_Powershell/" title="Working with Powershell" class="md-nav__link">
      Working with Powershell
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7">
    
    <label class="md-nav__link" for="nav-7">
      Release Notes
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        Release Notes
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7-1" type="checkbox" id="nav-7-1">
    
    <label class="md-nav__link" for="nav-7-1">
      2.0.0
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-7-1">
        2.0.0
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../Release_Notes/2.0.0/2.0.0/" title="Release - GA (v2.0.0)" class="md-nav__link">
      Release - GA (v2.0.0)
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Release_Notes/2.0.0/2.0.0_Breaking_Changes/" title="Breaking Changes - GA (v.2.0.0)" class="md-nav__link">
      Breaking Changes - GA (v.2.0.0)
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7-2" type="checkbox" id="nav-7-2">
    
    <label class="md-nav__link" for="nav-7-2">
      1.0.0
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-7-2">
        1.0.0
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../Release_Notes/1.0.0/1.0.0/" title="Release - GA (v1.0.0)" class="md-nav__link">
      Release - GA (v1.0.0)
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Release_Notes/1.0.0/1.0.0_Breaking_Changes/" title="Breaking Changes - GA (v.1.0.0)" class="md-nav__link">
      Breaking Changes - GA (v.1.0.0)
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7-3" type="checkbox" id="nav-7-3">
    
    <label class="md-nav__link" for="nav-7-3">
      0.4.0
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-7-3">
        0.4.0
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../Release_Notes/0.4.0/0.4.0/" title="Release - Early Preview 2 (v0.4.0)" class="md-nav__link">
      Release - Early Preview 2 (v0.4.0)
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Release_Notes/0.4.0/0.4.0_Breaking_Changes/" title="Breaking Changes - Early Preview 2 (v.0.4.0)" class="md-nav__link">
      Breaking Changes - Early Preview 2 (v.0.4.0)
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#how-does-delphix-ingest-data" title="How Does Delphix Ingest Data?" class="md-nav__link">
    How Does Delphix Ingest Data?
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#linking" title="Linking" class="md-nav__link">
    Linking
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#syncing" title="Syncing" class="md-nav__link">
    Syncing
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#our-syncing-strategy" title="Our Syncing Strategy" class="md-nav__link">
    Our Syncing Strategy
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#defining-your-linked-source-data-format" title="Defining Your Linked Source Data Format" class="md-nav__link">
    Defining Your Linked Source Data Format
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#implementing-syncing-in-your-plugin" title="Implementing Syncing in Your Plugin" class="md-nav__link">
    Implementing Syncing in Your Plugin
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mount-specification" title="Mount Specification" class="md-nav__link">
    Mount Specification
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#data-copying" title="Data Copying" class="md-nav__link">
    Data Copying
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#saving-snapshot-data" title="Saving Snapshot Data" class="md-nav__link">
    Saving Snapshot Data
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-to-link-and-sync-in-the-delphix-engine" title="How to Link and Sync in the Delphix Engine" class="md-nav__link">
    How to Link and Sync in the Delphix Engine
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="data-ingestion">Data Ingestion<a class="headerlink" href="#data-ingestion" title="Permanent link">&para;</a></h1>
<h2 id="how-does-delphix-ingest-data">How Does Delphix Ingest Data?<a class="headerlink" href="#how-does-delphix-ingest-data" title="Permanent link">&para;</a></h2>
<p>As <a href="../Discovery/">previously</a> discussed, the Delphix Engine uses the <a href="../../References/Glossary/#discovery">discovery</a> process to learn about datasets that live on a <a href="../../References/Glossary/#source-environment">source environment</a>. In this section we will learn how the Delphix Engine uses a two-step process to ingest a dataset.</p>
<h3 id="linking">Linking<a class="headerlink" href="#linking" title="Permanent link">&para;</a></h3>
<p>The first step is called <a href="../../References/Glossary/#linking">linking</a>. This is simply the creation of a new dataset on the Delphix Engine, which is associated with the dataset on the source environment. This new linked dataset is called a <a href="../../References/Glossary/#dsource">dSource</a>.</p>
<h3 id="syncing">Syncing<a class="headerlink" href="#syncing" title="Permanent link">&para;</a></h3>
<p>Immediately after linking, the new dSource is <a href="../../References/Glossary/#syncing">synced</a> for the first time. Syncing is a process by which data from the source environment is copied onto the Delphix Engine. Subsequent syncs may then be periodically performed in order to keep the dSource up-to-date.</p>
<p>The details of how this is done varies significantly from plugin to plugin. For example, some plugins will simply copy files from the filesystem. Other plugins might contact a DBMS and instruct it to send backup or replication streams. There are many possibilities here, but they all break down into two main strategies that the plugin author can choose from: direct and staging.</p>
<p>With the <a href="../../References/Glossary/#direct-linkingsyncing">direct</a> strategy, the plugin is not in charge
of the data copying. Instead the Delphix Engine directly pulls raw data from the source environment.
The plugin merely provides the location of the data. This is a very simple strategy, and is also
quite limiting.</p>
<p>For our first plugin, we will be using the more flexible <a href="../../References/Glossary/#staged-linkingsyncing">staging</a> strategy. With this strategy, the Delphix Engine uses NFS for Unix environments (or iSCSI on Windows environments) to mount storage onto a <a href="../../References/Glossary/#staging-environment">staging environment</a>. Our plugin will then be in full control of how to get data from the source environment onto this storage mount.</p>
<p>With the staging strategy, there are two types of syncs: sync and resync. A <code>sync</code> is used to ingestion incremental changes while a <code>resync</code> is used to re-ingest all the data for the dSource. For databases, this could mean re-ingesting from a full database backup to reset the dSource. A <code>sync</code> and a <code>resync</code> execute the same plugin operations and are differentiated by a boolean flag in the <a href="../../References/Classes/#snapshotparametersdefinition">snapshot_parameters</a> argument passed into <a href="../../References/Plugin_Operations/#staged-linked-source-pre-snapshot">linked.pre_snapshot</a> and <a href="../../References/Plugin_Operations/#staged-linked-source-post-snapshot">linked.post_snapshot</a>.</p>
<p>A regular <code>sync</code> is the default and is executed as part of policy driven syncs. A <code>resync</code> is only executed during initial ingestion or if the Delphix user manually starts one. The customer can manually trigger a <code>resync</code> via the UI by selecting the dSource, going to more options and selecting <strong>Resynchronize dSource</strong>. <img alt="Screenshot" src="../images/Resync.png" /></p>
<div class="admonition tip">
<p class="admonition-title">Gotcha</p>
<p>Although it is not common, it is entirely possible that the staging environment is the same as the source environment. Be careful not to assume otherwise in your plugins.</p>
</div>
<h3 id="our-syncing-strategy">Our Syncing Strategy<a class="headerlink" href="#our-syncing-strategy" title="Permanent link">&para;</a></h3>
<p>For our purposes here in this intro plugin, we will use a simple strategy. We won't do anything with the resync snapshot parameter and simply copy files from the filesystem on the source environment onto the NFS mount on the staging environment. We will do this by running the Unix tool <code>rsync</code> from our staging environment, and rely on passwordless SSH to connect to the source environment.</p>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>This plugin is assuming that <code>rsync</code> is installed on the staging host, and that the staging
host user is able to SSH into the source host without having to type in a password. A more
full-featured plugin would test these assumptions, usually as part of discovery.</p>
</div>
<p>In the special case mentioned above, where the staging environment is the same as the source environment, we could likely do something more efficient. However, for simplicity's sake, we won't do that here.</p>
<h2 id="defining-your-linked-source-data-format">Defining Your Linked Source Data Format<a class="headerlink" href="#defining-your-linked-source-data-format" title="Permanent link">&para;</a></h2>
<p>In order to be able to successfully do the copying required, plugins might need to get some information from the end-user of your plugin. In our case, we need to tell <code>rsync</code> how to access the files. This means we need to know the source environment's IP address (or domain name), the username we need to connect as, and finally the location where the files live.</p>
<p>Again, we will be using a JSON schema to define the data format. The user will be presented with a UI that lets them provide all the information our schema specifies.</p>
<p>Open up <code>schema.json</code> in your editor/IDE. Locate the <code>LinkedSourceDefinition</code> and replace it with the following schema:</p>
<div class="codehilite"><pre><span></span><span class="s2">&quot;linkedSourceDefinition&quot;</span><span class="err">:</span> <span class="p">{</span>
    <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;object&quot;</span><span class="p">,</span>
    <span class="nt">&quot;additionalProperties&quot;</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="nt">&quot;required&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;sourceAddress&quot;</span><span class="p">,</span> <span class="s2">&quot;username&quot;</span><span class="p">,</span> <span class="s2">&quot;mountLocation&quot;</span><span class="p">],</span>
    <span class="nt">&quot;properties&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;sourceAddress&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;string&quot;</span><span class="p">,</span>
            <span class="nt">&quot;prettyName&quot;</span><span class="p">:</span> <span class="s2">&quot;Host from which to copy&quot;</span><span class="p">,</span>
            <span class="nt">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;IP or FQDN of host from which to copy&quot;</span>
        <span class="p">},</span>
        <span class="nt">&quot;username&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;string&quot;</span><span class="p">,</span>
            <span class="nt">&quot;prettyName&quot;</span><span class="p">:</span> <span class="s2">&quot;Username on Source Host&quot;</span><span class="p">,</span>
            <span class="nt">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Username for making SSH connection to source host&quot;</span>
        <span class="p">},</span>
        <span class="nt">&quot;mountLocation&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;string&quot;</span><span class="p">,</span>
            <span class="nt">&quot;format&quot;</span><span class="p">:</span> <span class="s2">&quot;unixpath&quot;</span><span class="p">,</span>
            <span class="nt">&quot;prettyName&quot;</span><span class="p">:</span> <span class="s2">&quot;Mount Location on Staging Host&quot;</span><span class="p">,</span>
            <span class="nt">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Where to mount storage onto the staging host while syncing&quot;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span><span class="err">,</span>
</pre></div>


<div class="admonition info">
<p class="admonition-title">Info</p>
<p>As will be explained later, this schema will be used to generate Python code.
All names in the autogenerated Python code will use <code>lower_case_with_underscores</code> as attribute names as per Python variable naming conventions.
That is, if we were to use <code>mountLocation</code> as the schema property name, it would be called
<code>mount_location</code> in the generated Python code.</p>
</div>
<p>With this schema, the user will be required to provide the source username, the source's IP address, and the staging mount location as part of the linking process.</p>
<h2 id="implementing-syncing-in-your-plugin">Implementing Syncing in Your Plugin<a class="headerlink" href="#implementing-syncing-in-your-plugin" title="Permanent link">&para;</a></h2>
<p>There are three things we must do to implement syncing. First, we need to tell the Delphix Engine
where to mount storage onto the staging environment. Next we need to actually do the work of copying
data onto that mounted storage. Finally, we need to generate any snapshot-related data.</p>
<h3 id="mount-specification">Mount Specification<a class="headerlink" href="#mount-specification" title="Permanent link">&para;</a></h3>
<p>Before syncing can begin, the Delphix Engine needs to mount some storage onto the staging host.
Since different plugins can have different requirements about where exactly this mount lives, it is
up to the plugin to specify this location. As mentioned above, our simple plugin will get this
location from the user.</p>
<p>Open up the <code>plugin_runner.py</code> file and find the <code>linked_mount_specification</code> function (which was generated by <code>dvp init</code>). Replace it with the following code:</p>
<div class="codehilite"><pre><span></span>@plugin.linked.mount_specification()
def linked_mount_specification(staged_source, repository):
    mount_location = staged_source.parameters.mount_location
    mount = Mount(staged_source.staged_connection.environment, mount_location)
    return MountSpecification([mount])
</pre></div>


<p>Let's take this line-by-line to see what's going on here.</p>
<div class="codehilite"><pre><span></span>@plugin.linked.mount_specification()
</pre></div>


<p>This <a href="../../References/Glossary/#password-property">decorator</a> announces that the following function
is the code that handles the <code>mount_specification</code> operation. This is what allows the Delphix
Engine to know which function to call when it's time to learn where to mount. Every operation
definition will begin with a similar decorator.</p>
<div class="codehilite"><pre><span></span>def linked_mount_specification(staged_source, repository):
</pre></div>


<p>This begins a Python function definition. We chose to call it <code>linked_mount_specification</code>, but we
could have chosen any name at all. This function accepts two arguments, one giving information about
the linked source, and one giving information about the associated repository.</p>
<div class="codehilite"><pre><span></span>    mount_location = staged_source.parameters.mount_location
</pre></div>


<p>The <code>staged_source</code> input argument contains an attribute called <code>parameters</code>. This in turn contains
all of the properties defined by the <code>linkedSourceDefinition</code> schema. So, in our case, that means
it will contain attributes called <code>source_address</code>, <code>username</code>, and <code>mount_location</code>. Note how any attribute defined in <code>camelCase</code> in the schema is converted to <code>variable_with_underscores</code>. This line
simply retrieves the user-provided mount location and saves it in a local variable.</p>
<div class="codehilite"><pre><span></span>    mount = Mount(staged_source.staged_connection.environment, mount_location)
</pre></div>


<p>This line constructs a new object from the <a href="../../References/Classes/#mount">Mount class</a>. This class
holds details about how Delphix Engine storage is mounted onto remote environments. Here, we
create a mount object that says to mount onto the staging environment, at the location specified
by the user.</p>
<div class="codehilite"><pre><span></span>    return MountSpecification([mount])
</pre></div>


<p>On the line just before this one, we created an object that describes a <em>single</em> mount. Now, we
must return a full <a href="../../References/Glossary/#mount-specification">mount specification</a>. In general,
a mount specification is a collection of mounts. But, in our case, we just have one single mount.
Therefore, we use an array with only one item it in -- namely, the one single mount object we
created just above.</p>
<h3 id="data-copying">Data Copying<a class="headerlink" href="#data-copying" title="Permanent link">&para;</a></h3>
<p>As explained <a href="../../References/Workflows/#linked-source-sync">here</a>, the Delphix Engine will always run the plugin's <code>preSnapshot</code> operation just before taking a snapshot of the dsource. That means our <code>preSnapshot</code> operation has to get the NFS share into the desired state. For us, that means that's the time to do our data copy.</p>
<p>Unlike the previous operations we've seen so far, the pre-snapshot operation will not be autogenerated by <code>dvp init</code>.
So, we will need to add one ourselves.  Open up the <code>plugin_runner.py</code> file.</p>
<p>First, we'll add a new import line near the top of the file, so that we can use Delphix's platform libraries and raise user visible errors (explained below).</p>
<div class="codehilite"><pre><span></span><span class="kn">from</span> <span class="nn">dlpx.virtualization</span> <span class="kn">import</span> <span class="n">libs</span>
<span class="kn">from</span> <span class="nn">dlpx.virtualization.platform.exceptions</span> <span class="kn">import</span> <span class="n">UserError</span>
</pre></div>


<p>Next, we'll add a new function:</p>
<div class="codehilite"><pre><span></span><span class="nd">@plugin.linked.pre_snapshot</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">copy_data_from_source</span><span class="p">(</span><span class="n">staged_source</span><span class="p">,</span> <span class="n">repository</span><span class="p">,</span> <span class="n">source_config</span><span class="p">,</span> <span class="n">snapshot_parameters</span><span class="p">):</span>
    <span class="n">stage_mount_path</span> <span class="o">=</span> <span class="n">staged_source</span><span class="o">.</span><span class="n">mount</span><span class="o">.</span><span class="n">mount_path</span>
    <span class="n">data_location</span> <span class="o">=</span> <span class="s2">&quot;{}@{}:{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">staged_source</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">username</span><span class="p">,</span>
        <span class="n">staged_source</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">source_address</span><span class="p">,</span>
        <span class="n">source_config</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>

    <span class="n">rsync_command</span> <span class="o">=</span> <span class="s2">&quot;rsync -r {} {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">data_location</span><span class="p">,</span> <span class="n">stage_mount_path</span><span class="p">)</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">libs</span><span class="o">.</span><span class="n">run_bash</span><span class="p">(</span><span class="n">staged_source</span><span class="o">.</span><span class="n">staged_connection</span><span class="p">,</span> <span class="n">rsync_command</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">exit_code</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span>
            <span class="s2">&quot;Could not copy files.&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Ensure that passwordless SSH works for {}.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">staged_source</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">source_address</span><span class="p">),</span>
            <span class="n">result</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
</pre></div>


<p>Let's walk through this function and see what's going on</p>
<div class="codehilite"><pre><span></span>    <span class="n">stage_mount_path</span> <span class="o">=</span> <span class="n">staged_source</span><span class="o">.</span><span class="n">mount</span><span class="o">.</span><span class="n">mount_path</span>
</pre></div>


<p>The <code>staged_source</code> argument contains information about the current mount location. Here we save that
to a local variable for convenience.</p>
<div class="codehilite"><pre><span></span>    <span class="n">data_location</span> <span class="o">=</span> <span class="s2">&quot;{}@{}:{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">staged_source</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">username</span><span class="p">,</span>
        <span class="n">staged_source</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">source_address</span><span class="p">,</span>
        <span class="n">source_config</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
</pre></div>


<p>This code creates a Python string that represents the location of the data that we want to ingest.
This is in the form <code>&lt;user&gt;@&lt;host&gt;:&lt;path&gt;</code>. For example <code>jdoe@sourcehost.mycompany.com:/bin</code>. As
before with <code>mountLocation</code>, we have defined our schemas such that these three pieces of information
were provided by the user. Here we're just putting them into a format that <code>rsync</code> will understand.</p>
<div class="codehilite"><pre><span></span>    <span class="n">rsync_command</span> <span class="o">=</span> <span class="s2">&quot;rsync -r {} {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">data_location</span><span class="p">,</span> <span class="n">stage_mount_path</span><span class="p">)</span>
</pre></div>


<p>This line is the actual Bash command that we'll be running on the staging host. This will look something like <code>rsync -r user@host:/source/path /staging/mount/path</code>.</p>
<div class="codehilite"><pre><span></span>    <span class="n">result</span> <span class="o">=</span> <span class="n">libs</span><span class="o">.</span><span class="n">run_bash</span><span class="p">(</span><span class="n">staged_source</span><span class="o">.</span><span class="n">staged_connection</span><span class="p">,</span> <span class="n">rsync_command</span><span class="p">)</span>
</pre></div>


<p>This is an example of a <a href="../../References/Glossary/#platform-libraries">platform library</a> function, where we ask the Virtualization Platform
to do some work on our behalf. In this case, we're asking the platform to run our Bash command on the
staging environment. For full details on the <code>run_bash</code> platform library function and others, see this <a href="../../References/Platform_Libraries/">reference</a>.</p>
<div class="codehilite"><pre><span></span>    <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">exit_code</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span>
            <span class="s2">&quot;Could not copy files.&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Ensure that passwordless SSH works for {}.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">staged_source</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">source_address</span><span class="p">),</span>
            <span class="n">result</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
</pre></div>


<p>Finally, we check to see if our Bash command actually worked okay. If not, we raise an error
message, and describe one possible problem for the user to investigate. For more details on raising user visible errors, see this <a href="../../Best_Practices/User_Visible_Errors/">reference</a>.</p>
<h3 id="saving-snapshot-data">Saving Snapshot Data<a class="headerlink" href="#saving-snapshot-data" title="Permanent link">&para;</a></h3>
<p>Whenever the Delphix Engine takes a <a href="../../References/Glossary/#snapshot">snapshot</a> of a dSource or VDB,
the plugin has the chance to save any information it likes alongside that snapshot. Later, if the
snapshot is ever used to provision a new VDB, the plugin can use the previously-saved information
to help get the new VDB ready for use.</p>
<p>The format of this data is controlled by the plugin's <code>snapshotDefinition</code> schema. In our case, we
don't have any data we need to save. So, there's not much to do here. We will not modify the blank
schema that was created by <code>dvp init</code>.</p>
<p>We do still need to provide python function for the engine to call, but we don't have to do much.
In fact, the default implementation that was generated by <code>dvp init</code> will work just fine for our purposes:</p>
<div class="codehilite"><pre><span></span><span class="nd">@plugin.linked.post_snapshot</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">linked_post_snapshot</span><span class="p">(</span><span class="n">staged_source</span><span class="p">,</span>
                         <span class="n">repository</span><span class="p">,</span>
                         <span class="n">source_config</span><span class="p">,</span>
                         <span class="n">snapshot_parameters</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">SnapshotDefinition</span><span class="p">()</span>
</pre></div>


<p>The only thing this code is doing is creating a new object using our (empty) snapshot
definition, and returning that new empty object.</p>
<h2 id="how-to-link-and-sync-in-the-delphix-engine">How to Link and Sync in the Delphix Engine<a class="headerlink" href="#how-to-link-and-sync-in-the-delphix-engine" title="Permanent link">&para;</a></h2>
<p>Let's try it out and make sure this works!</p>
<p><strong>Prerequisites</strong></p>
<ul>
<li>
<p>You should already have a repository and source config set up from the previous page.</p>
</li>
<li>
<p>You can optionally set up a new staging environment. Or, you can simply re-use your source
    environment for staging.</p>
</li>
</ul>
<p><strong>Procedure</strong></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Recall that, for simplicity's sake, this plugin requires that passwordless SSH is set up between
your staging and source environments. You may want to verify this before continuing.</p>
</div>
<ol>
<li>
<p>As before, use <code>dvp build</code> and <code>dvp upload</code> to get your latest plugin changes installed onto
the Delphix Engine.</p>
</li>
<li>
<p>Go to <strong>Manage &gt; Environments</strong>, select your <strong>source</strong> environment, and then go to the <strong>Databases</strong> tab. Find <strong>Repository for our First Plugin</strong>, and your source config underneath it.</p>
</li>
<li>
<p>From your source config click <strong>Add dSource</strong>. This will begin the linking process. The first
screen you see should ask for the properties that you recently added to your <code>linkedSourceDefinition</code>. <img alt="Screenshot" src="../images/LinkingWizard.png" /></p>
</li>
<li>
<p>Walk through the remainder of the screens and hit <strong>Submit</strong>. This will kick off the initial link and first sync.</p>
</li>
<li>
<p>You can confirm that your new dSource was added successfully by going to <strong>Manage &gt; Datasets</strong>.</p>
</li>
</ol>
<p>After you have finished entering this information, the initial sync process will begin. This is what will call your pre-snapshot operation, thus copying data.</p>
<div class="admonition warning">
<p class="admonition-title">Gotcha</p>
<p>Manually creating a dSource sets your plugin’s linked source schema in stone, and you will have to recreate the dSource in order to modify your schema. We will cover how to deal with this correctly later, in the <a href="../../Versioning_And_Upgrade/Upgrade/">upgrade section</a>. For now, if you need to change your plugin's linked source schema, you will have to first delete any dSources you have manually added.</p>
</div>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../Discovery/" title="Discovery" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Discovery
              </span>
            </div>
          </a>
        
        
          <a href="../Provisioning/" title="Provisioning" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Provisioning
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2019 Delphix Corp.
          </div>
        
      </div>
      
        
  <div class="md-footer-social">
    <link rel="stylesheet" href="../../assets/fonts/font-awesome.css">
    
      <a href="https://www.delphix.com/" class="md-footer-social__link fa fa-sitemap"></a>
    
      <a href="https://www.facebook.com/DelphixCorp/" class="md-footer-social__link fa fa-facebook"></a>
    
      <a href="https://twitter.com/delphix" class="md-footer-social__link fa fa-twitter"></a>
    
      <a href="https://www.linkedin.com/company/delphix" class="md-footer-social__link fa fa-linkedin"></a>
    
      <a href="https://github.com/delphix" class="md-footer-social__link fa fa-github"></a>
    
  </div>

      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.878fdd8d.js"></script>
      
      <script>app.initialize({version:"0.17.5",url:{base:"../.."}})</script>
      
    
    
      
        <script>!function(e,a,t,n,o,c,i){e.GoogleAnalyticsObject=o,e.ga=e.ga||function(){(e.ga.q=e.ga.q||[]).push(arguments)},e.ga.l=1*new Date,c=a.createElement(t),i=a.getElementsByTagName(t)[0],c.async=1,c.src="https://www.google-analytics.com/analytics.js",i.parentNode.insertBefore(c,i)}(window,document,"script",0,"ga"),ga("create","UA-35429885-3","auto"),ga("set","anonymizeIp",!0),ga("send","pageview");var links=document.getElementsByTagName("a");if(Array.prototype.map.call(links,function(e){e.host!=document.location.host&&e.addEventListener("click",function(){var a=e.getAttribute("data-md-action")||"follow";ga("send","event","outbound",a,e.href)})}),document.forms.search){var query=document.forms.search.query;query.addEventListener("blur",function(){if(this.value){var e=document.location.pathname;ga("send","pageview",e+"?q="+this.value)}})}</script>
      
    
  </body>
</html>